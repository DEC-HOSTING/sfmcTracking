<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster Integration Test</title>
    <link rel="stylesheet" href="/static/css/auth.css">
    <style>
        .test-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 2px solid #000;
            padding: 15px;
            max-width: 300px;
            z-index: 9999;
        }
        .test-log {
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #ccc;
        }
        .test-status {
            padding: 5px;
            margin: 2px 0;
        }
        .pass { color: green; }
        .fail { color: red; }
        .info { color: blue; }
    </style>
</head>
<body class="auth-body">
    <!-- Test Panel -->
    <div class="test-panel">
        <h3>Integration Test</h3>
        <button onclick="runTests()">Run Tests</button>
        <div id="testResults" class="test-log"></div>
    </div>

    <!-- Original Auth Interface -->
    <div class="auth-container">
        <div class="auth-card">
            <header class="auth-header">
                <h1 class="app-title">TaskMaster</h1>
                <p class="app-subtitle">Modern task management with AI assistance</p>
            </header>

            <div class="auth-forms">
                <!-- Login Form -->
                <form class="auth-form" id="loginForm">
                    <h2 class="form-title">Welcome back</h2>
                    
                    <div class="form-group">
                        <label for="loginEmail">Email address</label>
                        <input 
                            type="email" 
                            id="loginEmail" 
                            name="email"
                            required 
                            placeholder="Enter your email"
                            autocomplete="email"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input 
                            type="password" 
                            id="loginPassword" 
                            name="password"
                            required 
                            placeholder="Enter your password"
                            autocomplete="current-password"
                        >
                    </div>
                    
                    <button type="submit" class="auth-btn primary" id="loginBtn">
                        <span class="btn-text">Sign In</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    
                    <div class="form-footer">
                        <p>Don't have an account? 
                            <button type="button" class="link-btn" id="showRegisterBtn">Create one</button>
                        </p>
                    </div>
                </form>

                <!-- Register Form -->
                <form class="auth-form" id="registerForm" style="display: none;">
                    <h2 class="form-title">Create account</h2>
                    
                    <div class="form-group">
                        <label for="registerEmail">Email address</label>
                        <input 
                            type="email" 
                            id="registerEmail" 
                            name="email"
                            required 
                            placeholder="Enter your email"
                            autocomplete="email"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input 
                            type="password" 
                            id="registerPassword" 
                            name="password"
                            required 
                            placeholder="Create a password (min 6 characters)"
                            autocomplete="new-password"
                            minlength="6"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm password</label>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword"
                            required 
                            placeholder="Confirm your password"
                            autocomplete="new-password"
                        >
                    </div>
                    
                    <button type="submit" class="auth-btn primary" id="registerBtn">
                        <span class="btn-text">Create Account</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    
                    <div class="form-footer">
                        <p>Already have an account? 
                            <button type="button" class="link-btn" id="showLoginBtn">Sign in</button>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Test Runner
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `test-status ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
            console.log(message);
        }

        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            log('üß™ Starting integration tests...', 'info');
            
            // Test 1: DOM Elements
            try {
                const loginForm = document.getElementById('loginForm');
                const registerForm = document.getElementById('registerForm');
                const showRegisterBtn = document.getElementById('showRegisterBtn');
                const showLoginBtn = document.getElementById('showLoginBtn');
                
                if (loginForm && registerForm && showRegisterBtn && showLoginBtn) {
                    log('‚úÖ All DOM elements found', 'pass');
                } else {
                    log('‚ùå Missing DOM elements', 'fail');
                }
            } catch (e) {
                log('‚ùå DOM test failed: ' + e.message, 'fail');
            }
            
            // Test 2: Form Switching
            try {
                const showRegisterBtn = document.getElementById('showRegisterBtn');
                const showLoginBtn = document.getElementById('showLoginBtn');
                const loginForm = document.getElementById('loginForm');
                const registerForm = document.getElementById('registerForm');
                
                // Test switch to register
                showRegisterBtn.click();
                setTimeout(() => {
                    if (registerForm.style.display !== 'none') {
                        log('‚úÖ Switch to register works', 'pass');
                    } else {
                        log('‚ùå Switch to register failed', 'fail');
                    }
                    
                    // Test switch back to login
                    showLoginBtn.click();
                    setTimeout(() => {
                        if (loginForm.style.display !== 'none') {
                            log('‚úÖ Switch to login works', 'pass');
                        } else {
                            log('‚ùå Switch to login failed', 'fail');
                        }
                    }, 100);
                }, 100);
            } catch (e) {
                log('‚ùå Form switching test failed: ' + e.message, 'fail');
            }
            
            // Test 3: Form Data Collection
            try {
                const loginForm = document.getElementById('loginForm');
                const emailField = document.getElementById('loginEmail');
                const passwordField = document.getElementById('loginPassword');
                
                emailField.value = 'test@example.com';
                passwordField.value = 'testpass123';
                
                const formData = new FormData(loginForm);
                const email = formData.get('email');
                const password = formData.get('password');
                
                if (email === 'test@example.com' && password === 'testpass123') {
                    log('‚úÖ Form data collection works', 'pass');
                } else {
                    log('‚ùå Form data collection failed', 'fail');
                }
                
                // Clear fields
                emailField.value = '';
                passwordField.value = '';
            } catch (e) {
                log('‚ùå Form data test failed: ' + e.message, 'fail');
            }
            
            // Test 4: CSS Styles
            try {
                const authContainer = document.querySelector('.auth-container');
                const computedStyle = window.getComputedStyle(authContainer);
                
                if (computedStyle.display !== 'none') {
                    log('‚úÖ CSS styles loaded properly', 'pass');
                } else {
                    log('‚ùå CSS styles not loaded', 'fail');
                }
            } catch (e) {
                log('‚ùå CSS test failed: ' + e.message, 'fail');
            }
            
            log('üéâ Integration tests completed', 'info');
        }

        // Auto-run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('üìã Page loaded, ready for testing', 'info');
            setTimeout(runTests, 1000);
        });
    </script>
    
    <script src="/static/js/auth.js"></script>
</body>
</html>
